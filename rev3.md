# Keyboard Quantizer ビルドガイド(Rev3)

![rev3](img/rev3_rear.jpg)

## キット内容
本キットには以下の部品が入っています

|部品|数量|
|--|--|
|メイン基板(表面実装部品実装済み) |1
|USBプラグ |1
|USBレセプタクル |1
|ケース |1

## 組み立て
- USBコネクタをはんだ付けし、ケースに入れます
  ![rev3_build](img/rev3_build.jpg)
- ケースを開けるときはマイナスドライバーなど薄いものを側面の隙間にいれてこじ開けてください
  - 鋭利な工具を使用する場合は怪我に注意してください

## ファームウェア(QMK)
- rev3はatmega32u4を内蔵しています。書き込むファームウェアは[このリポジトリ](https://github.com/sekigon-gonnoc/qmk_firmware/tree/dev/sekigon)のdev/sekigonブランチです
    ```bash
        # qmk_quantizerというフォルダ名でリポジトリをクローン
        git clone https://github.com/sekigon-gonnoc/qmk_firmware.git -b dev/sekigon qmk_quantizer
        # defaultキーマップを書きこみ
        make keyboard_quantizer/rev3:default:flash
        # またはviaキーマップを書きこみ
        make keyboard_quantizer/rev3:via:flash
    ```
- 未組立版の場合、最初に組み立てるときはdefaultキーマップを書き込んでください。次の手順に必要です。
- VIAキーマップはVIA Configuratorに対応しています
  - レイヤ数の初期値は6で、設定変更でより増やすこともできます
  - VIA Configuratorからキーマップを書き換えるには[keyboard-quantizer.json](keyboard-quantizer.json)を読み込ませてください
- ブートローダを以下のいずれかの手順で起動できます
  - Quantizerにキーボードを挿していない状態でPCに接続する
  - キーマップに割り当てたRESETキーを押す
  - (defaultキーマップ)シリアルポートを1200bpsで開いてから閉じる

## (未組立版の組立時のみ)ホスト用ファームの書きこみ

- Python 3.7以上が必要です
- atmega32u4にdefaultキーマップのファームが書き込まれている前提です

  ```bash
  # COMポート名をデバイスマネージャ等で確認して指定
  ./ch559update.py flash -p <COM port> -f CH559USB.bin
  ```

  - 実行時にエラーが出る場合はpyserialを追加してください
     ```
      pip install pyserial
     ```

  - 以下のメッセージが表示されたら完了です。PCから抜き差しして電源を入れ直してください
    ```
      Chip erase start...
      Chip erase complete.
      Flash start...
      .............................................................................................................................................................................................................................................................................................................
      Flash complete.
      Verify start...
      .............................................................................................................................................................................................................................................................................................................
      Verify complete.
    ```
